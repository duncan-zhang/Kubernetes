# Pod

## Imperative
```bash
kubectl run web --image=nginx
```
```sh
kubectl run client --image=busybox --command -- bin/sh -c "sleep 100000"
```
僅能建立單一`containerd`

## Declarative
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: web
spec:
   containers:
    - name: nginx-container
      image: nginx:latest
```
```sh
kubectl apply -f nginx.yml
```
## multi container pod

## kubectl dry-run

### Server-side
```sh
kubectl apply -f nginx.yml --dry-run=server
```
### Client-side
```sh
kubectl apply -f nginx.yml --dry-run=client
```
```sh
kubectl run web --image=nginx --dry-run=client -o yaml
```
```sh
kubectl run web --image=nginx --dry-run=client -o yaml > nginx.yml
```

## kubectl diff
比較目前運行與新yaml有什麼差異
```sh
kubectl diff -f new-nginx.yml
```

## Pod的基本操作
```sh
kubectl get pods
```
```sh
kubectl get pods client
```
```sh
kubectl delete pod web
```
詳述pod內容
```sh
kubectl describe pod my-pod
``` 
## 登入Container中
登入容器中
```sh
kubectl exec client -- date
```
查詢
```sh
kubectl exec client -it -- sh
```
指定登入(多容器中)
```sh
kubectl exec my-pod -c
```
```sh
kubectl exec my-pod -c nginx -- date
```

## API level log
--watch 持續監聽kubectl
```sh
kubectl get pod <pod-name> -v 6
kubectl get pods <pod-name> --watch -v 6
```
後臺執行事件日誌
```sh
kubectl get events -w &
```

## kubectl proxy
透過proxy才能直接訪問k8s api
後臺執行
```sh
kubectl proxy &
```
通过proxy来访问API了，例如
```sh
curl http://127.0.0.1:8001/api/v1/namespaces?limit=500
```
## Static Pod
Managed by the kubelet on Node  
kubelet’s configuration, by default is `/etc/kubernetes/manifests`  
kubelet configuration file: `/var/lib/kubelet/config.yaml`  

## Namespace
```sh
kubectl get ns
kubectl describe ns
kubectl get ns -A
kubectl create namespace demo
kubectl delete namespaces demo
```
## Change default namespace
查看
```sh
kubectl config get-contexts
```
切換default到ns demo
```sh
kubectl config set-context --current --namespace demo
```
------